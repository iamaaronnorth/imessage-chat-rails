<div class="<%= message.user == current_user ? 'flex justify-end' : 'flex justify-start' %>" id="message_<%= message.id %>">
  <div class="max-w-xs lg:max-w-md px-4 py-2 rounded-2xl relative <%= message.user == current_user ? 'bg-blue-500 text-white ml-12' : 'bg-white text-gray-800 mr-12 border border-gray-200' %>">
    <!-- Message content -->
    <div class="text-sm leading-relaxed">
      <%= simple_format(message.content, { class: "mb-0" }, wrapper_tag: "div") %>
    </div>
    
    <!-- Message metadata -->
    <div class="flex items-center justify-between mt-1 text-xs <%= message.user == current_user ? 'text-blue-100' : 'text-gray-500' %>">
      <div class="flex items-center space-x-2">
        <% unless message.user == current_user %>
          <span class="font-medium"><%= message.user.display_name %></span>
          <span>â€¢</span>
        <% end %>
        <span><%= message.created_at.strftime("%I:%M %p") %></span>
      </div>
      
      <% if message.user == current_user %>
        <%= link_to room_message_path(@room, message), 
            method: :delete, 
            data: { 
              confirm: "Are you sure you want to delete this message?",
              turbo_method: :delete 
            },
            class: "text-blue-100 hover:text-white opacity-50 hover:opacity-100 ml-2" do %>
          <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
          </svg>
        <% end %>
      <% end %>
    </div>
    
    <!-- Message tail (to make it look like a speech bubble) -->
    <% if message.user == current_user %>
      <!-- Blue bubble tail pointing right -->
      <div class="absolute top-2 -right-1 w-0 h-0" style="
        border-left: 8px solid #3B82F6;
        border-top: 4px solid transparent;
        border-bottom: 4px solid transparent;
      "></div>
    <% else %>
      <!-- White bubble tail pointing left -->
      <div class="absolute top-2 -left-1 w-0 h-0" style="
        border-right: 8px solid white;
        border-top: 4px solid transparent;
        border-bottom: 4px solid transparent;
        filter: drop-shadow(-1px 0px 0px rgba(229, 231, 235, 1));
      "></div>
    <% end %>
  </div>
</div>